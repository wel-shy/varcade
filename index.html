<!DOCTYPE html>
<html lang="en" dir="ltr">
<!-- https://www.npmjs.com/package/aframe-environment-component -->
<head>
  <meta charset="utf-8">
  <script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
  <title>varcade</title>
</head>

<body>
  <script>
  let rotateTimeout;
  let gazeInterval;
  const gazeThreshold = 3000;

  const riddles = [
    {
      question: "What has many keys, but can't even open a single door?",
      answer: 'A piano.',
    },
    {
      question: 'What comes once in a minute, twice in a moment, but never in a thousand years?',
      answer: 'The letter M.',
    },
    {
      question: 'What has a head, a tail, is brown, and has no legs?',
      answer: 'A penny.',
    },
  ];

  // TODO: Delete, callback placeholder
  function print() {
    console.log('callback executed');
  }

  /**
   * Get the text element and display a random bit of trivia.
   */
  function displayRandomTrivia() {
    const textEl = document.querySelector('#prompt');
    textEl.setAttribute('value', riddles[Math.floor(Math.random() * riddles.length)].question);
  };

  /**
   * Detect gaze handler.
   */
  AFRAME.registerComponent('detect-gaze', {
    schema: {
      callback: {default: ''}
    },

    init() {
      const el = this.el;
      const callback = this.data.callback;

      /**
       * Detect a gaze.
       *
       * Should set a timeout and execute a function after.
       */
      el.addEventListener('mouseenter', () => {
        gazeTimeout = setTimeout(() => {
          window[callback]();
        }, gazeThreshold);
      });

      /**
       * Clear the interval when the mouse leaves.
       */
      el.addEventListener('mouseleave', () => {
        clearTimeout(gazeTimeout);
      });
    }
  });
  </script>

  <a-scene fog="type: linear; color: #AAA">
    <a-box id="slot-machine" src="https://cdn.glitch.com/af5ada0c-8fca-45ff-a2da-795fd849bc5d%2Fslot-machine-2304135_1920.png?1554552910277" position="0.5 0.5 0.3" rotation="0 0 0"  height="1.5" shadow detect-gaze="callback: print"></a-box>
    <a-cylinder color="black" height="1.1" radius = "0.05" position="1.12 0.8 0.3"></a-cylinder>
        <a-sphere color="red" radius="0.1" position = "1.12 1.35 0.3" detect-gaze="callback: displayRandomTrivia"></a-sphere>
        <a-sphere color="grey" radius="0.2" position ="1 0.34 0.27"></a-sphere>
    <a-text id="prompt" value="Pull the lever for some Trivia" color="#000"
            position="-0.9 2.5 -3" scale="1.5 1.5 1.5"></a-text>
    <a-light type="directional" color="#FFF" intensity="0.5" position="-1 1 2">
    </a-light>
    <a-light type="ambient" color="#FFF">
    </a-light>
    <a-camera position="0 1 4" cursor-visible="true" cursor-scale="2" cursor-color="#0095DD" cursor-opacity="0.5" look-controls>
      <a-cursor fuse="true" timeout="5000"></a-cursor>
    </a-camera>
    <a-entity environment="preset: forest; dressingAmount: 250; dressingColor: #006400; ground: hills; groundTexture: walkernoise; groundColor: #556b2f; groundColor2: #6b8e23; shadow: true; skyType: atmosphere;"></a-entity>
  </a-scene>
</body>

</html>
